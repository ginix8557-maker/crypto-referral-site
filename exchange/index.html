<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ì½”ì¸ ë ˆí¼ëŸ´ ëª¨ìŒ</title>
  <meta name="description" content="ê±°ë˜ì†Œ ë ˆí¼ëŸ´ ì •ë³´ë¥¼ ê¹”ë”í•˜ê²Œ ëª¨ì•„ë‘” í˜ì´ì§€ì…ë‹ˆë‹¤. ê²€ìƒ‰ìœ¼ë¡œ ë¹ ë¥´ê²Œ ì°¾ê³ , ìƒì„¸ í˜ì´ì§€ì—ì„œ ë§í¬ë¥¼ í™•ì¸í•˜ì„¸ìš”." />

  <!-- ê³µí†µ CSS -->
  <link rel="stylesheet" href="../assets/styles.css" />
</head>
<body>
  <main class="container">
    <div class="topbar">
      <div>
        <h1 class="page-title">í‚´ìŠ¤ í˜ì´ë°±</h1>
        <p class="page-subtitle">í•´ì™¸ ê±°ë˜ì†Œ ìˆ˜ìˆ˜ë£Œ í• ì¸ ì •ë³´</p>
      </div>

      <div class="search" role="search" aria-label="ê²€ìƒ‰">
        <span aria-hidden="true">ğŸ”</span>
        <input id="q" type="search" placeholder="ê±°ë˜ì†Œ ì´ë¦„/í‚¤ì›Œë“œ ê²€ìƒ‰ (ì˜ˆ: ì—…ë¹„íŠ¸, ë¹—ì¸, ë°”ì´ë‚¸ìŠ¤)" />
      </div>
    </div>

    <!-- ì¹´ë“œ ëª©ë¡ì´ ë“¤ì–´ê°ˆ ì˜ì—­: card-grid -->
    <section id="cards" class="card-grid" aria-label="ë ˆí¼ëŸ´ ëª©ë¡"></section>

    <div class="footer">
      Â© <span id="y"></span> Coin Referral. Built with HTML/CSS/JS (no build tools).
    </div>
  </main>

  <script>
    // footer year
    document.getElementById('y').textContent = new Date().getFullYear();

    const $cards = document.getElementById('cards');
    const $q = document.getElementById('q');

    let all = [];

    // ====== small inline logos (SVG) ======
    const LOGO_SVGS = {
      binance: `<svg class="ex-logo-svg" viewBox="0 0 24 24" aria-hidden="true" focusable="false" xmlns="http://www.w3.org/2000/svg">
        <path d="m16.624 13.92 2.717 2.716-7.353 7.353-7.352-7.352 2.717-2.717 4.636 4.66 4.635-4.66zm4.637-4.636L24 12l-2.715 2.716L18.568 12l2.693-2.716zm-9.272 0 2.716 2.692-2.717 2.717L9.272 12l2.716-2.715zm-9.273 0L5.41 12l-2.692 2.692L0 12l2.716-2.716zM11.99.01l7.352 7.33-2.717 2.715-4.636-4.636-4.635 4.66-2.717-2.716L11.989.011z"/>
      </svg>`,

      bybit: `<svg class="ex-logo-svg" viewBox="0 0 1024 1024" aria-hidden="true" focusable="false" xmlns="http://www.w3.org/2000/svg">
        <path d="M584.7 462.5h-1.2c-10.1.1-20 2.9-28.7 8.1v-67.4h-27.4v118.5c0 32.4 25.6 59.2 57.4 59.2 31.8 0 57.4-26.8 57.4-59.2-.2-33-25.1-59.2-57.5-59.2zm-1.3 88.5c-15.8-.3-28.7-13.5-28.7-29.3 0-16.2 12.5-29.9 28.7-29.9s28.7 13.7 28.7 29.9-12.5 29.3-28.7 29.3zM314 462.5c-10.3 0-20.5 2.8-29.3 8.1v-67.4H256v118.5c0 32.4 26.2 59.2 58 59.2 31.2 0 57.4-26.8 57.4-59.2 0-33-25.6-59.2-57.4-59.2zm0 88.5c-16.1 0-29.3-13.2-29.3-29.3 0-16.2 13.1-29.9 29.3-29.9 15.6 0 28.7 13.7 28.7 29.9S329.6 551 314 551zm362.3-103.5c3.7 0 7.5-1.2 10-4.4 3.1-2.5 4.4-6.2 4.4-10.6 0-3.7-1.2-7.5-4.4-10-2.5-3.1-6.2-4.4-10-4.4-3.7 0-7.5 1.2-10 4.4-3.1 2.5-4.4 6.2-4.4 10 .1 8.8 6.3 15 14.4 15M506.1 581.6c0 32.4-26.2 59.2-57.4 59.2v-29.9c16.2 0 28.7-13.1 28.7-29.3v-8.1a56.235 56.235 0 0 1-57.4 0c-17.8-10.9-28.7-30.3-28.7-51.1v-59.2H420v59.2c0 13.1 8.7 24.9 21.2 28.7 2.2.5 4.5.8 6.9.8 16.1 0 29.3-13.2 29.3-29.3v-59.4h28.7v118.4zm247.6-179v59.2H768v29.9h-14.3v88.6h-28.1v-88.6h-14.3v-29.9h14.3v-59.2h28.1zm-94.2 58h28.7v118.5h-28.7V460.6z"/>
      </svg>`,

      okx: `<svg class="ex-logo-svg" viewBox="0 0 24 24" aria-hidden="true" focusable="false" xmlns="http://www.w3.org/2000/svg">
        <rect x="2.2" y="7.2" width="3.6" height="3.6" rx="0.6"></rect>
        <rect x="6.4" y="7.2" width="3.6" height="3.6" rx="0.6"></rect>
        <rect x="10.6" y="7.2" width="3.6" height="3.6" rx="0.6"></rect>
        <rect x="14.8" y="7.2" width="3.6" height="3.6" rx="0.6"></rect>
        <text x="12" y="16.9" text-anchor="middle" font-size="7.5" font-weight="800" font-family="system-ui, -apple-system, 'Apple SD Gothic Neo', 'Noto Sans KR', sans-serif">OKX</text>
      </svg>`,

      bitget: `<svg class="ex-logo-svg" viewBox="0 0 24 24" aria-hidden="true" focusable="false" xmlns="http://www.w3.org/2000/svg">
        <path d="M6.2 12.2l5.2-5.2a1 1 0 0 1 1.4 0l5 5a1 1 0 0 1 0 1.4l-5.2 5.2a1 1 0 0 1-1.4 0l-1.6-1.6 2-2 1 1 4-4-4-4-4 4 1 1-2 2-1.8-1.8a1 1 0 0 1 0-1.4z"></path>
      </svg>`,

      telegram: `<svg class="ex-logo-svg" viewBox="0 0 24 24" aria-hidden="true" focusable="false" xmlns="http://www.w3.org/2000/svg">
        <path d="M9.04 15.6l-.38 5.34c.54 0 .77-.23 1.05-.5l2.52-2.4 5.23 3.82c.96.53 1.64.25 1.89-.88l3.42-16.04c.32-1.46-.52-2.04-1.45-1.7L1.26 9.1c-1.41.55-1.39 1.32-.25 1.67l5.43 1.7L19.7 6.8c.62-.41 1.18-.18.72.23z"/>
      </svg>`
    };


    function pickLogoSvg(item) {
      const t = String(item.title || item.name || '').toLowerCase();
      if (t.includes('binance') || t.includes('ë°”ì´ë‚¸ìŠ¤')) return LOGO_SVGS.binance;
      if (t.includes('bybit') || t.includes('ë°”ì´ë¹„íŠ¸')) return LOGO_SVGS.bybit;
      if (t.includes('okx') || t.includes('ì˜¤ì¼€ì´ì—‘ìŠ¤')) return LOGO_SVGS.okx;
      if (t.includes('bitget') || t.includes('ë¹„íŠ¸ê²Ÿ')) return LOGO_SVGS.bitget;
      if (t.includes('í…”ë ˆê·¸ë¨') || t.includes('telegram')) return LOGO_SVGS.telegram;

      return '';
    }


    function escapeHtml(s) {
      return String(s ?? '')
        .replaceAll('&', '&amp;')
        .replaceAll('<', '&lt;')
        .replaceAll('>', '&gt;')
        .replaceAll('"', '&quot;')
        .replaceAll("'", '&#39;');
    }

    function makeCard(item) {
      // item í•„ë“œëŠ” referrals.json êµ¬ì¡°ì— ë§ì¶° ì‚¬ìš©:
      // id, title, summary(or description), subline, tags, link
      const id = item.id;
      const rawTitle = item.title || item.name || id;

      // ì œëª©ì—ì„œ "(binance)" ê°™ì€ ì˜ë¬¸ì´ ë¶™ì–´ìˆìœ¼ë©´ ë¶„ë¦¬
      let titleMain = rawTitle;
      let titleEn = '';
      const m = String(rawTitle).match(/^(.*)\(([^)]+)\)\s*$/);
      if (m) {
        titleMain = m[1].trim();
        titleEn = m[2].trim();
      }

      // ì§€ë‹ˆ JSONì€ summaryë¥¼ ì“°ê³  ìˆìœ¼ë‹ˆ summary ìš°ì„ 
      const desc = 'ê³µì‹ ê°€ì… í˜ì´ì§€ë¡œ ì´ë™';
      const subline = item.subline || item.feeLine || '';
      const logoSvg = pickLogoSvg(item);

      const detailUrl = `./detail.html?id=${encodeURIComponent(id)}`;
      const externalLink = item.link || item.url || item.referralUrl || '';

      const externalBtn = externalLink
        ? `<a class="btn btn-primary" href="${escapeHtml(externalLink)}" target="_blank" rel="noopener noreferrer">
            ${id === 'support-telegram' ? 'í…”ë ˆê·¸ë¨ ë¬¸ì˜í•˜ê¸°' : 'ê°€ì…í•˜ê¸°'}
           </a>`
        : `<a class="btn btn-primary" href="${detailUrl}">ìƒì„¸ì—ì„œ í™•ì¸</a>`;


      // íˆì–´ë¡œ ë°°ì§€: tags ì¤‘ '%' ë“¤ì–´ê°„ í•­ëª© (ì˜ˆ: "50% í• ì¸", "20% í• ì¸")
      const tags = Array.isArray(item.tags) ? item.tags : [];
      const hero = tags.find(t => /%/.test(String(t))) || '';

      // â€œì‹œì¥ê°€ ê¸°ì¤€â€ ë¼ë²¨ì€ tagsì— ìˆìœ¼ë©´ ì‚¬ìš©, ì—†ìœ¼ë©´ ê¸°ë³¸ê°’
      const basis = tags.find(t => String(t).includes('ì‹œì¥ê°€')) || 'ì‹œì¥ê°€ ê¸°ì¤€';

      // sublineì—ì„œ "ì‹œì¥ê°€ ìˆ˜ìˆ˜ë£Œ" ê°™ì€ ì•ë¶€ë¶„ì€ ì œê±°í•´ì„œ ìˆ«ìë§Œ ë‚¨ê¸°ê¸°
      const feeNumbersRaw = String(subline || '')
        .replace(/^ì‹œì¥ê°€\s*ìˆ˜ìˆ˜ë£Œ\s*/g, '')
        .replace(/^ì‹œì¥ê°€\s*/g, '')
        .trim();

      let feeNumbers = feeNumbersRaw;
      if (feeNumbersRaw.includes('â†’')) {
        const [before, after] = feeNumbersRaw.split('â†’').map(s => s.trim());
        feeNumbers = `${before} â†’ <span class="after">${after}</span>`;
      }


      // íƒœê·¸ëŠ” ì¹´ë“œ ì•„ë˜ì—ì„œ ì§€ì €ë¶„í•´ì§€ì§€ ì•Šê²Œ: hero(í• ì¸ìœ¨) / ì‹œì¥ê°€ ê¸°ì¤€ì€ ì œì™¸
      const cleanTags = tags.filter(t => t !== hero && !String(t).includes('ì‹œì¥ê°€'));
      const tagsHtml = cleanTags.slice(0, 4).map(t => `<span class="pill">${escapeHtml(t)}</span>`).join('');

      return `
        <article class="card">
          <div class="card-head">

            <h2 class="card-title card-title-wrap">
              ${logoSvg ? `<span class="ex-logo" aria-hidden="true">${logoSvg}</span>` : ``}
              <span class="ex-title-text">
                ${escapeHtml(titleMain)}${titleEn ? `<span class="title-en">${escapeHtml(titleEn)}</span>` : ``}
              </span>
            </h2>

            ${hero ? `<div class="hero-badge">${escapeHtml(hero)}</div>` : ``}
          </div>
          <div class="card-divider"></div>



          ${feeNumbers ? `
            <div class="fee-box">
              <div class="fee-row">
                <span class="fee-label">${escapeHtml(basis)}</span>
                <p class="fee-value">${feeNumbers}</p>
              </div>
            </div>
          ` : ``}

          ${desc ? `<p class="card-desc">${escapeHtml(desc)}</p>` : ``}

          ${tagsHtml ? `<div class="card-meta">${tagsHtml}</div>` : ``}

          <div class="actions">
            ${externalBtn}
            <a class="btn btn-outline" href="${detailUrl}">ìì„¸íˆë³´ê¸°</a>
          </div>
        </article>
      `;
    }



    function render(list) {
      if (!list.length) {
        $cards.innerHTML = `
          <div class="detail">
            <h1>ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ì–´ìš”</h1>
            <p>ë‹¤ë¥¸ í‚¤ì›Œë“œë¡œ ê²€ìƒ‰í•´ë³´ì„¸ìš”.</p>
          </div>
        `;
        return;
      }
      $cards.innerHTML = list.map(makeCard).join('');
    }

    function applySearch() {
      const q = ($q.value || '').trim().toLowerCase();
      if (!q) return render(all);

      const filtered = all.filter(it => {
        const blob = [
          it.id,
          it.title, it.name,
          it.description, it.desc,
          Array.isArray(it.tags) ? it.tags.join(' ') : ''
        ].join(' ').toLowerCase();

        return blob.includes(q);
      });

      render(filtered);
    }

    async function load() {
      try {
        const res = await fetch('../data/referrals.json', { cache: 'no-store' });
        if (!res.ok) throw new Error('referrals.json ë¡œë“œ ì‹¤íŒ¨: ' + res.status);

        const data = await res.json();

        // dataê°€ ë°°ì—´ì´ê±°ë‚˜ {items:[...]} í˜•íƒœì¼ ìˆ˜ ìˆì–´ì„œ ë‘˜ ë‹¤ ì§€ì›
        all = Array.isArray(data) ? data : (Array.isArray(data.items) ? data.items : []);

        // id ì—†ëŠ” ë°ì´í„°ëŠ” ì œì™¸
        all = all.filter(x => x && x.id);

        render(all);
      } catch (err) {
        console.error(err);
        $cards.innerHTML = `
          <div class="detail">
            <h1>ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆì–´ìš”</h1>
            <p>../data/referrals.json íŒŒì¼ ê²½ë¡œ ë˜ëŠ” JSON ë¬¸ë²•(ì‰¼í‘œ/ë”°ì˜´í‘œ)ì„ í™•ì¸í•´ì£¼ì„¸ìš”.</p>
          </div>
        `;
      }
    }

    $q.addEventListener('input', applySearch);

    load();
  </script>
</body>
</html>
